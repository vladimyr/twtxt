var u=function(parameter,context){if(!(this instanceof u)){return new u(parameter,context);}
if(parameter instanceof u){return parameter;}
if(typeof parameter==='string'){parameter=this.select(parameter,context);}
if(parameter&&parameter.nodeName){parameter=[parameter];}
this.nodes=this.slice(parameter);};u.prototype={get length(){return this.nodes.length;}};u.prototype.nodes=[];u.prototype.addClass=function(){return this.eacharg(arguments,function(el,name){el.classList.add(name);});};u.prototype.adjacent=function(html,data,callback){if(typeof data==='number'){if(data===0){data=[];}else{data=new Array(data).join().split(',').map(Number.call,Number);}}
return this.each(function(node,j){var fragment=document.createDocumentFragment();u(data||{}).map(function(el,i){var part=(typeof html==='function')?html.call(this,el,i,node,j):html;if(typeof part==='string'){return this.generate(part);}
return u(part);}).each(function(n){this.isInPage(n)?fragment.appendChild(u(n).clone().first()):fragment.appendChild(n);});callback.call(this,node,fragment);});};u.prototype.after=function(html,data){return this.adjacent(html,data,function(node,fragment){node.parentNode.insertBefore(fragment,node.nextSibling);});};u.prototype.append=function(html,data){return this.adjacent(html,data,function(node,fragment){node.appendChild(fragment);});};u.prototype.args=function(args,node,i){if(typeof args==='function'){args=args(node,i);}
if(typeof args!=='string'){args=this.slice(args).map(this.str(node,i));}
return args.toString().split(/[\s,]+/).filter(function(e){return e.length;});};u.prototype.array=function(callback){callback=callback;var self=this;return this.nodes.reduce(function(list,node,i){var val;if(callback){val=callback.call(self,node,i);if(!val)val=false;if(typeof val==='string')val=u(val);if(val instanceof u)val=val.nodes;}else{val=node.innerHTML;}
return list.concat(val!==false?val:[]);},[]);};u.prototype.attr=function(name,value,data){data=data?'data-':'';return this.pairs(name,value,function(node,name){return node.getAttribute(data+name);},function(node,name,value){node.setAttribute(data+name,value);});};u.prototype.before=function(html,data){return this.adjacent(html,data,function(node,fragment){node.parentNode.insertBefore(fragment,node);});};u.prototype.children=function(selector){return this.map(function(node){return this.slice(node.children);}).filter(selector);};u.prototype.clone=function(){return this.map(function(node,i){var clone=node.cloneNode(true);var dest=this.getAll(clone);this.getAll(node).each(function(src,i){for(var key in this.mirror){if(this.mirror[key]){this.mirror[key](src,dest.nodes[i]);}}});return clone;});};u.prototype.getAll=function getAll(context){return u([context].concat(u('*',context).nodes));};u.prototype.mirror={};u.prototype.mirror.events=function(src,dest){if(!src._e)return;for(var type in src._e){src._e[type].forEach(function(ref){u(dest).on(type,ref.callback);});}};u.prototype.mirror.select=function(src,dest){if(u(src).is('select')){dest.value=src.value;}};u.prototype.mirror.textarea=function(src,dest){if(u(src).is('textarea')){dest.value=src.value;}};u.prototype.closest=function(selector){return this.map(function(node){do{if(u(node).is(selector)){return node;}}while((node=node.parentNode)&&node!==document);});};u.prototype.data=function(name,value){return this.attr(name,value,true);};u.prototype.each=function(callback){this.nodes.forEach(callback.bind(this));return this;};u.prototype.eacharg=function(args,callback){return this.each(function(node,i){this.args(args,node,i).forEach(function(arg){callback.call(this,node,arg);},this);});};u.prototype.empty=function(){return this.each(function(node){while(node.firstChild){node.removeChild(node.firstChild);}});};u.prototype.filter=function(selector){var callback=function(node){node.matches=node.matches||node.msMatchesSelector||node.webkitMatchesSelector;return node.matches(selector||'*');};if(typeof selector==='function')callback=selector;if(selector instanceof u){callback=function(node){return(selector.nodes).indexOf(node)!==-1;};}
return u(this.nodes.filter(callback));};u.prototype.find=function(selector){return this.map(function(node){return u(selector||'*',node);});};u.prototype.first=function(){return this.nodes[0]||false;};u.prototype.generate=function(html){if(/^\s*<tr[> ]/.test(html)){return u(document.createElement('table')).html(html).children().children().nodes;}else if(/^\s*<t(h|d)[> ]/.test(html)){return u(document.createElement('table')).html(html).children().children().children().nodes;}else if(/^\s*</.test(html)){return u(document.createElement('div')).html(html).children().nodes;}else{return document.createTextNode(html);}};u.prototype.handle=function(){var args=this.slice(arguments).map(function(arg){if(typeof arg==='function'){return function(e){e.preventDefault();arg.apply(this,arguments);};}
return arg;},this);return this.on.apply(this,args);};u.prototype.hasClass=function(){return this.is('.'+this.args(arguments).join('.'));};u.prototype.html=function(text){if(text===undefined){return this.first().innerHTML||'';}
return this.each(function(node){node.innerHTML=text;});};u.prototype.is=function(selector){return this.filter(selector).length>0;};u.prototype.isInPage=function isInPage(node){return(node===document.body)?false:document.body.contains(node);};u.prototype.last=function(){return this.nodes[this.length-1]||false;};u.prototype.map=function(callback){return callback?u(this.array(callback)).unique():this;};u.prototype.not=function(filter){return this.filter(function(node){return!u(node).is(filter||true);});};u.prototype.off=function(events,cb,cb2){var cb_filter_off=(cb==null&&cb2==null);var sel=null;var cb_to_be_removed=cb;if(typeof cb==='string'){sel=cb;cb_to_be_removed=cb2;}
return this.eacharg(events,function(node,event){u(node._e?node._e[event]:[]).each(function(ref){if(cb_filter_off||(ref.orig_callback===cb_to_be_removed&&ref.selector===sel)){node.removeEventListener(event,ref.callback);}});});};u.prototype.on=function(events,cb,cb2){var sel=null;var orig_callback=cb;if(typeof cb==='string'){sel=cb;orig_callback=cb2;cb=function(e){var args=arguments;var targetFound=false;u(e.currentTarget).find(sel).each(function(target){if(target===e.target||target.contains(e.target)){targetFound=true;try{Object.defineProperty(e,'currentTarget',{get:function(){return target;}});}catch(err){}
cb2.apply(target,args);}});if(!targetFound&&e.currentTarget===e.target){cb2.apply(e.target,args);}};}
var callback=function(e){return cb.apply(this,[e].concat(e.detail||[]));};return this.eacharg(events,function(node,event){node.addEventListener(event,callback);node._e=node._e||{};node._e[event]=node._e[event]||[];node._e[event].push({callback:callback,orig_callback:orig_callback,selector:sel});});};u.prototype.pairs=function(name,value,get,set){if(typeof value!=='undefined'){var nm=name;name={};name[nm]=value;}
if(typeof name==='object'){return this.each(function(node){for(var key in name){set(node,key,name[key]);}});}
return this.length?get(this.first(),name):'';};u.prototype.param=function(obj){return Object.keys(obj).map(function(key){return this.uri(key)+'='+this.uri(obj[key]);}.bind(this)).join('&');};u.prototype.parent=function(selector){return this.map(function(node){return node.parentNode;}).filter(selector);};u.prototype.prepend=function(html,data){return this.adjacent(html,data,function(node,fragment){node.insertBefore(fragment,node.firstChild);});};u.prototype.remove=function(){return this.each(function(node){if(node.parentNode){node.parentNode.removeChild(node);}});};u.prototype.removeClass=function(){return this.eacharg(arguments,function(el,name){el.classList.remove(name);});};u.prototype.replace=function(html,data){var nodes=[];this.adjacent(html,data,function(node,fragment){nodes=nodes.concat(this.slice(fragment.children));node.parentNode.replaceChild(fragment,node);});return u(nodes);};u.prototype.scroll=function(){this.first().scrollIntoView({behavior:'smooth'});return this;};u.prototype.select=function(parameter,context){parameter=parameter.replace(/^\s*/,'').replace(/\s*$/,'');if(/^</.test(parameter)){return u().generate(parameter);}
return(context||document).querySelectorAll(parameter);};u.prototype.serialize=function(){var self=this;return this.slice(this.first().elements).reduce(function(query,el){if(!el.name||el.disabled||el.type==='file')return query;if(/(checkbox|radio)/.test(el.type)&&!el.checked)return query;if(el.type==='select-multiple'){u(el.options).each(function(opt){if(opt.selected){query+='&'+self.uri(el.name)+'='+self.uri(opt.value);}});return query;}
return query+'&'+self.uri(el.name)+'='+self.uri(el.value);},'').slice(1);};u.prototype.siblings=function(selector){return this.parent().children(selector).not(this);};u.prototype.size=function(){return this.first().getBoundingClientRect();};u.prototype.slice=function(pseudo){if(!pseudo||pseudo.length===0||typeof pseudo==='string'||pseudo.toString()==='[object Function]')return[];return pseudo.length?[].slice.call(pseudo.nodes||pseudo):[pseudo];};u.prototype.str=function(node,i){return function(arg){if(typeof arg==='function'){return arg.call(this,node,i);}
return arg.toString();};};u.prototype.text=function(text){if(text===undefined){return this.first().textContent||'';}
return this.each(function(node){node.textContent=text;});};u.prototype.toggleClass=function(classes,addOrRemove){if(!!addOrRemove===addOrRemove){return this[addOrRemove?'addClass':'removeClass'](classes);}
return this.eacharg(classes,function(el,name){el.classList.toggle(name);});};u.prototype.trigger=function(events){var data=this.slice(arguments).slice(1);return this.eacharg(events,function(node,event){var ev;var opts={bubbles:true,cancelable:true,detail:data};try{ev=new window.CustomEvent(event,opts);}catch(e){ev=document.createEvent('CustomEvent');ev.initCustomEvent(event,true,true,data);}
node.dispatchEvent(ev);});};u.prototype.unique=function(){return u(this.nodes.reduce(function(clean,node){var istruthy=node!==null&&node!==undefined&&node!==false;return(istruthy&&clean.indexOf(node)===-1)?clean.concat(node):clean;},[]));};u.prototype.uri=function(str){return encodeURIComponent(str).replace(/!/g,'%21').replace(/'/g,'%27').replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/\*/g,'%2A').replace(/%20/g,'+');};u.prototype.wrap=function(selector){function findDeepestNode(node){while(node.firstElementChild){node=node.firstElementChild;}
return u(node);}
return this.map(function(node){return u(selector).each(function(n){findDeepestNode(n).append(node.cloneNode(true));node.parentNode.replaceChild(n,node);});});};if(typeof module==='object'&&module.exports){module.exports=u;module.exports.u=u;}
(function(){if(typeof window.Element==="undefined"||"classList"in document.documentElement)return;var prototype=Array.prototype,push=prototype.push,splice=prototype.splice,join=prototype.join;function DOMTokenList(el){this.el=el;var classes=el.className.replace(/^\s+|\s+$/g,'').split(/\s+/);for(var i=0;i<classes.length;i++){push.call(this,classes[i]);}};DOMTokenList.prototype={add:function(token){if(this.contains(token))return;push.call(this,token);this.el.className=this.toString();},contains:function(token){return this.el.className.indexOf(token)!=-1;},item:function(index){return this[index]||null;},remove:function(token){if(!this.contains(token))return;for(var i=0;i<this.length;i++){if(this[i]==token)break;}
splice.call(this,i,1);this.el.className=this.toString();},toString:function(){return join.call(this,' ');},toggle:function(token){if(!this.contains(token)){this.add(token);}else{this.remove(token);}
return this.contains(token);}};window.DOMTokenList=DOMTokenList;function defineElementGetter(obj,prop,getter){if(Object.defineProperty){Object.defineProperty(obj,prop,{get:getter});}else{obj.__defineGetter__(prop,getter);}}
defineElementGetter(Element.prototype,'classList',function(){return new DOMTokenList(this);});})();var Twix=(function(){function Twix(){}
Twix.ajax=function(options){options=options||{url:""};options.type=options.type.toUpperCase()||'GET';options.headers=options.headers||{};options.timeout=parseInt(options.timeout)||0;options.success=options.success||function(){};options.error=options.error||function(){};options.async=typeof options.async==='undefined'?true:options.async;var client=new XMLHttpRequest();if(options.timeout>0){client.timeout=options.timeout;client.ontimeout=function(){options.error('timeout','timeout',client);};}
client.open(options.type,options.url,options.async);for(var i in options.headers){if(options.headers.hasOwnProperty(i)){client.setRequestHeader(i,options.headers[i]);}}
client.send(options.data);client.onreadystatechange=function(){if(this.readyState==4&&((this.status>=200&&this.status<300)||this.status==304)){var data=this.responseText;var contentType=this.getResponseHeader('Content-Type');if(contentType&&contentType.match(/json/)){data=JSON.parse(this.responseText);}
options.success(data,this.statusText,this);}else if(this.readyState==4){options.error(this.status,this.statusText,this);}};if(options.async==false){if(client.readyState==4&&((client.status>=200&&client.status<300)||client.status==304)){options.success(client.responseText,client);}else if(client.readyState==4){options.error(client.status,client.statusText,client);}}
return client;};var _ajax=function(type,url,data,callback){if(typeof data==="function"){callback=data;data=undefined;}
return Twix.ajax({url:url,data:data,type:type,success:callback});};Twix.get=function(url,data,callback){return _ajax("GET",url,data,callback);};Twix.head=function(url,data,callback){return _ajax("HEAD",url,data,callback);};Twix.post=function(url,data,callback){return _ajax("POST",url,data,callback);};Twix.patch=function(url,data,callback){return _ajax("PATCH",url,data,callback);};Twix.put=function(url,data,callback){return _ajax("PUT",url,data,callback);};Twix.delete=function(url,data,callback){return _ajax("DELETE",url,data,callback);};Twix.options=function(url,data,callback){return _ajax("OPTIONS",url,data,callback);};return Twix;})();__=Twix;var dropCookie=true;var cookieDuration=14;var cookieName="complianceCookie";var cookieValue="on";var $mentionedList=u("#mentioned-list").first();var lastSymbol="";function createDiv(){u("body").prepend('<div id="cookie-law" class="container-fluid"><p>This website uses cookies. By continuing we assume your permission to deploy cookies, as detailed in our <a href="/privacy" rel="nofollow" title="Privacy Policy">privacy policy</a>. <a role="button" href="javascript:void(0);" onclick="removeMe();">Close</a></p></div>');createCookie(window.cookieName,window.cookieValue,window.cookieDuration);}
if(!Array.prototype.findIndex){Array.prototype.findIndex=function(predicate){if(this==null){throw new TypeError("Array.prototype.findIndex called on null or undefined");}
if(typeof predicate!=="function"){throw new TypeError("predicate must be a function");}
var list=Object(this);var length=list.length>>>0;var thisArg=arguments[1];var value;for(var i=0;i<length;i++){value=list[i];if(predicate.call(thisArg,value,i,list)){return i;}}
return-1;};}
if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(predicate){if(this==null){throw new TypeError('"this" is null or not defined');}
var o=Object(this);var len=o.length>>>0;if(typeof predicate!=="function"){throw new TypeError("predicate must be a function");}
var thisArg=arguments[1];var k=0;while(k<len){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o)){return kValue;}
k++;}
return undefined;},configurable:true,writable:true,});}
function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+days*24*60*60*1000);var expires="; expires="+date.toGMTString();}else var expires="";if(window.dropCookie){document.cookie=name+"="+value+expires+"; path=/";}}
function checkCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" ")c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}
return null;}
function eraseCookie(name){createCookie(name,"",-1);}
window.onload=function(){if(checkCookie(window.cookieName)!=window.cookieValue){createDiv();}};function removeMe(){var element=document.getElementById("cookie-law");element.parentNode.removeChild(element);}
function replyTo(e){e.preventDefault();var el=u("textarea#text");var text=document.getElementById("text");var reply=u(e.target).data("reply");if(u("#replyTo").first().value!=""){reply=reply.replace("("+u("#replyTo").first().value+") ","")}
el.empty();text.value=reply;el.scroll();text.focus();var size=text.value.length;text.setSelectionRange(size,size);}
function editTwt(e){e.preventDefault();var el=u("textarea#text");var text=document.getElementById("text");el.empty();text.value=u(e.target).data("text");el.scroll();text.focus();var size=text.value.length;text.setSelectionRange(size,size);u("#replaceTwt").first().value=u(e.target).data("hash");}
function deleteTwt(e){e.preventDefault();if(confirm("Are you sure you want to delete this twt? This cannot be undone!")){Twix.ajax({type:"DELETE",url:u("#form").attr("action"),success:function(data){var hash=u(e.target).data("hash");u("#"+hash).remove();},});}}
u("#theme input").on("change",function(e){var value=u(e.target).first().value;switch(value){case "auto":u("html").data("theme","");break;case "light":case "dark":u("html").data("theme",value);break;default:console.log("invalid theme: "+value);}});u(".reply").on("click",replyTo);u(".edit").on("click",editTwt);u(".delete").on("click",deleteTwt);u("#post").on("click",function(e){e.preventDefault();u("#post").html('<i class="icss-spinner icss-pulse"></i>&nbsp;Posting...');u("#post").attr("disabled",true);u("#form").first().submit();});u.prototype.getSelection=function(){var e=this.first();return((("selectionStart"in e&&function(){var l=e.selectionEnd-e.selectionStart;return{start:e.selectionStart,end:e.selectionEnd,length:l,text:e.value.substr(e.selectionStart,l),};})||(document.selection&&function(){e.focus();var r=document.selection.createRange();if(r===null){return{start:0,end:e.value.length,length:0};}
var re=e.createTextRange();var rc=re.duplicate();re.moveToBookmark(r.getBookmark());rc.setEndPoint("EndToStart",re);return{start:rc.text.length,end:rc.text.length+r.text.length,length:r.text.length,text:r.text,};})||function(){return null;})());};u.prototype.replaceSelection=function(){var e=this.first();var text=arguments[0]||"";return((("selectionStart"in e&&function(){e.value=e.value.substr(0,e.selectionStart)+
text+
e.value.substr(e.selectionEnd,e.value.length);return this;})||(document.selection&&function(){e.focus();document.selection.createRange().text=text;return this;})||function(){e.value+=text;return jQuery(e);})());};function createMentionedUserNode(username){return u("<div>").addClass("user-list__user").append(u("<div>").addClass("avatar").attr("style","background-image: url('/user/"+username+"/avatar.png')")).append(u("<div>").addClass("info").append(u("<div>").addClass("nickname").text(username)));}
function formatText(selector,fmt){selector.first().focus();var finalText="";var start=selector.first().selectionStart;var selectedText=selector.getSelection().text;if(selectedText.length==0){finalText=fmt+fmt;}else{finalText=fmt+selectedText+fmt;}
selector.replaceSelection(finalText,true);selector.first().focus();if(!selectedText.length){var selectionRange=start+fmt.length;selector.first().setSelectionRange(selectionRange,selectionRange);}}
function insertText(selector,text){var start=selector.first().selectionStart;selector.first().value.slice(startMention,start);selector.replaceSelection(text,false);selector.first().focus();var selectionRange=selector.first().value.substr(start+text.length-1,1)===")"?start+text.length-1:start+text.length;selector.first().setSelectionRange(selectionRange,selectionRange);}
function iOS(){return(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod",].indexOf(navigator.platform)!==-1||(navigator.userAgent.indexOf("Mac")!==-1&&"ontouchend"in document));}
function IE(){return!!window.MSInputMethodContext&&!!document.documentMode;}
var deBounce=300;var fetchUsersTimeout=null;function getUsers(searchStr){clearTimeout(fetchUsersTimeout);fetchUsersTimeout=setTimeout(function(){let requestUrl="/lookup";if(searchStr){requestUrl+="?prefix="+searchStr;}
Twix.ajax({type:"GET",url:requestUrl,success:function(data){u("#mentioned-list-content").empty();data.map(function(name){u("#mentioned-list-content").append(createMentionedUserNode(name));});if(data.length){u(".user-list__user").first().classList.add("selected");}},});},deBounce);}
var mentions=[];u("#bBtn").on("click",function(e){e.preventDefault();formatText(u("textarea#text"),"**");});u("#iBtn").on("click",function(e){e.preventDefault();formatText(u("textarea#text"),"*");});u("#sBtn").on("click",function(e){e.preventDefault();formatText(u("textarea#text"),"~~");});u("#cBtn").on("click",function(e){e.preventDefault();formatText(u("textarea#text"),"`");});u("#lnkBtn").on("click",function(e){e.preventDefault();insertText(u("textarea#text"),"[title](https://)");});u("#imgBtn").on("click",function(e){e.preventDefault();insertText(u("textarea#text"),"![](https://)");});u("#usrBtn").on("click",function(e){e.preventDefault();if(!$mentionedList.classList.contains("show")){u("textarea#text").first().focus();startMention=u("textarea#text").first().selectionStart+1;insertText(u("textarea#text"),"@");if(iOS()||IE()){showMentionedList();getUsers();}}else{clearMentionedList();}});u("#writeBtn").on("click",function(e){e.preventDefault();u("#title").attr("type","");u("#title").first().focus();u("#post").html('<i class="icss-print"></i>&nbsp;Publish!');u("#text").attr("wrap","hard");u("#text").attr("maxlength","");u("#text").attr("rows",24);u("#form").attr("action","/blog");});u("textarea#text").on("focus",function(e){if(e.relatedTarget===u("#usrBtn").first()){showMentionedList();getUsers();}});var startMention=null;u("textarea#text").on("keyup",function(e){if(e.key.length===1||e.key==="Backspace"){var idx=e.target.selectionStart;var prevSymbol=e.target.value.slice(idx-1,idx);if(prevSymbol==="@"){startMention=idx;showMentionedList();}
if($mentionedList.classList.contains("show")){var searchStr=e.target.value.slice(startMention,idx);console.log("searchStr",searchStr);if(!prevSymbol.trim()){clearMentionedList();startMention=null;}else{getUsers(searchStr);}}}});u("#mentioned-list-content").on("mousemove",function(e){var target=e.target;u(".user-list__user").nodes.forEach(function(item){item.classList.remove("selected");});if(target.classList.contains("user-list__user")){target.classList.add("selected");}});u("#mentioned-list").on("click",function(e){var value=u("textarea#text").first().value;u("textarea#text").first().value=value.slice(0,startMention)+
value.slice(u("textarea#text").first().selectionEnd);u("textarea#text").first().setSelectionRange(startMention,startMention);insertText(u("textarea#text"),e.target.innerText.trim());u("#mentioned-list").first().classList.remove("show");});u("#uploadMedia").on("change",function(e){u("#uploadMediaButton").removeClass("icss-camera");u("#uploadMediaButton").addClass("icss-spinner icss-pulse");u("#uploadForm").data("tooltip","Uploading...");u("#uploadMedia").html('<i class="icss-spinner icss-pulse"></i>');Twix.ajax({type:"POST",url:u("#uploadForm").attr("action"),data:new FormData(u("#uploadForm").first()),success:function(data){var el=u("textarea#text");var text=document.getElementById("text");text.value+=" ![]("+data.Path+") ";el.scroll();text.focus();var size=el.text().length;text.setSelectionRange(size,size);u("#uploadMediaButton").removeClass("icss-spinner icss-pulse");u("#uploadMediaButton").addClass("icss-camera");u("#uploadForm").data("tooltip","Upload");},error:function(statusCode,statusText){u("#uploadMediaButton").removeClass("icss-spinner icss-pulse");u("#uploadMediaButton").addClass("icss-camera");alert("An error occurred uploading your media: "+
statusCode+
" "+
statusText);},});});u("#burgerMenu").on("click",function(e){e.preventDefault();if(u("#mainNav").hasClass("responsive")){u("#mainNav").removeClass("responsive");}else{u("#mainNav").addClass("responsive");}});u("body").on("keydown",function(e){if(u("#mentioned-list").first()){if(u("#mentioned-list").first().classList.contains("show")){if(e.key==="Escape"){clearMentionedList();}
if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="Up"||e.key==="Down"){e.preventDefault();var selectedIdx=u(".user-list__user").nodes.findIndex(function(item){return item.classList.contains("selected");});var nextIdx;var scrollOffset;if(e.key==="ArrowDown"||e.key==="Down"){nextIdx=selectedIdx+1===u(".user-list__user").length?0:selectedIdx+1;}else if(e.key==="ArrowUp"||e.key==="Up"){nextIdx=selectedIdx-1<0?u(".user-list__user").length-1:selectedIdx-1;}
scrollOffset=u(".user-list__user").first().clientHeight*(nextIdx-2);u(".user-list__user").nodes.forEach(function(item,index){item.classList.remove("selected");if(index===nextIdx){u("#mentioned-list-content").first().scrollTop=scrollOffset>0?scrollOffset:0;item.classList.add("selected");}});}
if(e.key==="Tab"||e.key==="Enter"){e.preventDefault();var selectedNodeIdx=u(".user-list__user").nodes.findIndex(function(item){return item.classList.contains("selected");});var selectedNode=u(".user-list__user").nodes[selectedNodeIdx];var value=u("textarea#text").first().value;u("textarea#text").first().value=value.slice(0,startMention)+
value.slice(u("textarea#text").first().selectionEnd);u("textarea#text").first().setSelectionRange(startMention,startMention);insertText(u("textarea#text"),selectedNode.innerText.trim());clearMentionedList();}
var caret=u("textarea#text").first().selectionStart;var prevSymbol=u("textarea#text").first().value.slice(caret-1,1);if(e.key==="Backspace"&&prevSymbol==="@"){console.log("remove @");clearMentionedList();}}}});function clearMentionedList(){$mentionedList.classList.remove("show");u("#mentioned-list-content").first().innerHTML="";}
function showMentionedList(){$mentionedList.classList.add("show");u("#mentioned-list").first().style.top=u("textarea#text").first().clientHeight+2+"px";}
if(window.performance.getEntriesByType("navigation")[0].type==="back_forward"){window.scrollTo(0,Number(localStorage.getItem("prevOffset")));}
window.onbeforeunload=function(){localStorage.setItem("prevOffset",localStorage.getItem("currentOffset")||String(window.scrollY));localStorage.setItem("currentOffset",String(window.scrollY));};